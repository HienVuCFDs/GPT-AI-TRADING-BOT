# ğŸ¤– Trading AI Server - Pro Models
## Tá»•ng quan

Server cháº¡y **3 models Ä‘á»™c láº­p** trÃªn **3 ports**:

| Model | Port | Type | Parameters | Best For |
|-------|------|------|------------|----------|
| XGBoost | 5001 | Gradient Boosting | ~100K | Tabular indicators, nhanh |
| CNN+LSTM Pro | 5002 | Deep Learning | 6.8M | Patterns + Trends |
| Transformer Pro | 5003 | Deep Learning | 9.3M | Long-range dependencies |

## ğŸš€ Khá»Ÿi Ä‘á»™ng Server

```bash
# Cháº¡y táº¥t cáº£ 3 models (Pro version - máº·c Ä‘á»‹nh)
python ai_server/trading_ai_server.py --all

# Cháº¡y táº¥t cáº£ vá»›i Basic version
python ai_server/trading_ai_server.py --all --basic

# Cháº¡y 1 model cá»¥ thá»ƒ
python ai_server/trading_ai_server.py --model cnn_lstm
python ai_server/trading_ai_server.py --model transformer
python ai_server/trading_ai_server.py --model xgboost
```

## ğŸ“¡ API Endpoints

### Má»—i model cÃ³ 3 endpoints:

```
POST http://localhost:{port}/predict  - Dá»± Ä‘oÃ¡n signal
GET  http://localhost:{port}/health   - Health check
GET  http://localhost:{port}/info     - Model info
```

### VÃ­ dá»¥ request:

```python
import requests

# Gá»i CNN+LSTM Pro
response = requests.post('http://localhost:5002/predict', json={
    'indicators': {
        'M15': {
            'RSI14': 45.5,
            'MACD_12_26_9': 0.0012,
            'ADX14': 25.3,
            'ATR14': 0.0015,
            'close': 1.0850,
            ...
        }
    },
    'patterns': {
        'bullish_engulfing': 1,
        'hammer': 0,
        ...
    },
    'sr_levels': {
        'support': [1.0800, 1.0750],
        'resistance': [1.0900, 1.0950],
        ...
    }
})

result = response.json()
# {
#     'model': 'cnn_lstm_pro',
#     'signal': 'BUY',
#     'confidence': 78.5,
#     'probabilities': {'BUY': 78.5, 'SELL': 12.3, 'HOLD': 9.2},
#     'market_regime': 'TREND_UP',
#     'risk': 0.35,
#     ...
# }
```

## ğŸ§  CNN+LSTM Pro Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      CNN+LSTM Pro Model                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ Price Data  â”‚    â”‚ Indicators  â”‚    â”‚  Patterns   â”‚          â”‚
â”‚  â”‚  (OHLCV)    â”‚    â”‚ (20 feats)  â”‚    â”‚ (29 feats)  â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚         â”‚                  â”‚                  â”‚                  â”‚
â”‚         â–¼                  â–¼                  â”‚                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚                  â”‚
â”‚  â”‚     Multi-Scale TCN                  â”‚     â”‚                  â”‚
â”‚  â”‚  (Dilated Causal Convolutions)       â”‚     â”‚                  â”‚
â”‚  â”‚  Scales: 1, 2, 4, 8                  â”‚     â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚                  â”‚
â”‚                     â”‚                         â”‚                  â”‚
â”‚                     â–¼                         â”‚                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚                  â”‚
â”‚  â”‚     Cross-Modal Attention            â”‚     â”‚                  â”‚
â”‚  â”‚  Price â†” Indicators fusion           â”‚     â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚                  â”‚
â”‚                     â”‚                         â”‚                  â”‚
â”‚                     â–¼                         â”‚                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚                  â”‚
â”‚  â”‚   Hierarchical BiLSTM (2 layers)     â”‚     â”‚                  â”‚
â”‚  â”‚     + Temporal Query Attention       â”‚     â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚                  â”‚
â”‚                     â”‚                         â”‚                  â”‚
â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                               â”‚                                  â”‚
â”‚                               â–¼                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚  â”‚        Pattern Embedding             â”‚                        â”‚
â”‚  â”‚   + Market Regime Detection          â”‚                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                     â”‚                                            â”‚
â”‚                     â–¼                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚  â”‚       Multi-Task Heads               â”‚                        â”‚
â”‚  â”‚  â€¢ Signal: BUY/SELL/HOLD             â”‚                        â”‚
â”‚  â”‚  â€¢ Regime: TREND/RANGING/VOLATILE    â”‚                        â”‚
â”‚  â”‚  â€¢ Confidence: 0-100%                â”‚                        â”‚
â”‚  â”‚  â€¢ Risk: 0-1                         â”‚                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”® Transformer Pro Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Transformer Pro Model                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ Price Data  â”‚    â”‚ Indicators  â”‚    â”‚ SR Levels   â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚         â”‚                  â”‚                  â”‚                  â”‚
â”‚         â–¼                  â–¼                  â”‚                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚                  â”‚
â”‚  â”‚    Rotary Position Embedding         â”‚     â”‚                  â”‚
â”‚  â”‚          (RoPE)                       â”‚     â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚                  â”‚
â”‚                     â”‚                         â”‚                  â”‚
â”‚                     â–¼                         â”‚                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚                  â”‚
â”‚  â”‚   Hierarchical Transformer           â”‚     â”‚                  â”‚
â”‚  â”‚   â€¢ Local Encoder (fine-grained)     â”‚     â”‚                  â”‚
â”‚  â”‚   â€¢ Global Encoder (coarse)          â”‚     â”‚                  â”‚
â”‚  â”‚   â€¢ Fusion Layer                     â”‚     â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚                  â”‚
â”‚                     â”‚                         â”‚                  â”‚
â”‚                     â–¼                         â”‚                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚                  â”‚
â”‚  â”‚   Multi-Scale Attention              â”‚     â”‚                  â”‚
â”‚  â”‚   Scales: 1, 2, 4                    â”‚     â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚                  â”‚
â”‚                     â”‚                         â”‚                  â”‚
â”‚                     â–¼                         â”‚                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚                  â”‚
â”‚  â”‚   Cross-Modal Transformer Blocks     â”‚     â”‚                  â”‚
â”‚  â”‚   (2 layers)                         â”‚     â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚                  â”‚
â”‚                     â”‚                         â”‚                  â”‚
â”‚                     â–¼                         â”‚                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚                  â”‚
â”‚  â”‚    Mixture of Experts (MoE)          â”‚     â”‚                  â”‚
â”‚  â”‚    4 experts, top-2 routing          â”‚     â”‚                  â”‚
â”‚  â”‚    (specialized for market states)   â”‚     â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚                  â”‚
â”‚                     â”‚                         â”‚                  â”‚
â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                               â”‚                                  â”‚
â”‚                               â–¼                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚  â”‚      Uncertainty Head                â”‚                        â”‚
â”‚  â”‚   (Predicts mean + variance)         â”‚                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                     â”‚                                            â”‚
â”‚                     â–¼                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚  â”‚       Multi-Task Heads               â”‚                        â”‚
â”‚  â”‚  â€¢ Signal: BUY/SELL/HOLD             â”‚                        â”‚
â”‚  â”‚  â€¢ Regime: TREND/RANGING/VOLATILE    â”‚                        â”‚
â”‚  â”‚  â€¢ Confidence: 0-100%                â”‚                        â”‚
â”‚  â”‚  â€¢ Uncertainty: variance estimate    â”‚                        â”‚
â”‚  â”‚  â€¢ Volatility: predicted vol         â”‚                        â”‚
â”‚  â”‚  â€¢ Magnitude: price movement size    â”‚                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š Training

```bash
# Train cáº£ 3 models
python ai_server/training/train_models.py

# Training sáº½:
# 1. Load data tá»« ai_training_pending/
# 2. Balance cÃ¡c classes (BUY/SELL/HOLD)
# 3. Train vá»›i Focal Loss (chá»‘ng class imbalance)
# 4. Early stopping náº¿u khÃ´ng cáº£i thiá»‡n
# 5. LÆ°u best model vÃ o ai_server/saved_models/
```

## ğŸ”§ Cáº¥u hÃ¬nh

### Thay Ä‘á»•i ports:

```bash
python ai_server/trading_ai_server.py --all \
    --xgboost-port 6001 \
    --cnn-lstm-port 6002 \
    --transformer-port 6003
```

### Chuyá»ƒn CPU/GPU:

```bash
# Force CPU
python ai_server/trading_ai_server.py --all --no-gpu
```

## ğŸ“ Cáº¥u trÃºc thÆ° má»¥c

```
ai_server/
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ cnn_lstm_model.py      # Basic CNN+LSTM (~500K params)
â”‚   â”œâ”€â”€ cnn_lstm_pro.py        # Pro CNN+LSTM (~6.8M params)
â”‚   â”œâ”€â”€ transformer_model.py   # Basic Transformer (~800K params)
â”‚   â””â”€â”€ transformer_pro.py     # Pro Transformer (~9.3M params)
â”œâ”€â”€ training/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ data_loader.py         # Load tá»« ai_training_pending/
â”‚   â””â”€â”€ train_models.py        # Training script
â”œâ”€â”€ saved_models/              # Trained model checkpoints
â”‚   â”œâ”€â”€ cnn_lstm_pro_best.pt
â”‚   â”œâ”€â”€ transformer_pro_best.pt
â”‚   â””â”€â”€ xgboost_model.json
â””â”€â”€ trading_ai_server.py       # Multi-port Flask server
```

## âš¡ So sÃ¡nh Models

| Feature | XGBoost | CNN+LSTM Pro | Transformer Pro |
|---------|---------|--------------|-----------------|
| Parameters | ~100K | 6.8M | 9.3M |
| Speed | âš¡ Very Fast | ğŸš€ Fast | ğŸ¢ Slower |
| Pattern Detection | âŒ | âœ… Multi-Scale | âœ… Attention |
| Trend Learning | âŒ | âœ… BiLSTM | âœ… Hierarchical |
| Long-range | âŒ | âš ï¸ Limited | âœ… Full |
| Uncertainty | âŒ | âš ï¸ Confidence only | âœ… Full |
| Market Regime | âŒ | âœ… 4 regimes | âœ… 4 regimes |
| MoE | âŒ | âŒ | âœ… 4 experts |

## ğŸ¯ Recommendations

1. **Quick decisions**: Use XGBoost (port 5001)
2. **Pattern-based trading**: Use CNN+LSTM Pro (port 5002)
3. **Complex analysis**: Use Transformer Pro (port 5003)
4. **Ensemble**: Call all 3 and vote for final decision

---
*Powered by PyTorch + Flask*
